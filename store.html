import React, { useState, useEffect } from 'react';
import { 
  ShoppingCart, 
  Search, 
  Menu, 
  X, 
  Plus, 
  Minus, 
  Trash2, 
  CreditCard, 
  Banknote,
  CheckCircle, 
  Terminal,
  Shield,
  Lock,
  Cpu,
  Activity,
  Wifi,
  ShoppingBag,
  ArrowRight,
  MapPin,
  Star,
  Users,
  ThumbsUp,
  Code
} from 'lucide-react';

// --- Mock Data ---
const CATEGORIES = ["ALL_NODES", "WHATSAPP_PROTOCOL", "REACT_INJECTION"];

const PRODUCTS = [
  { id: 13, name: "WA_FOLLOWERS_1K", price: 500.00, unit: "unit", category: "WHATSAPP_PROTOCOL", rating: 5.0, image: "bg-gray-900 text-green-500 border border-green-500/30", icon: <Users className="w-8 h-8" /> },
  { id: 14, name: "WA_FOLLOWERS_1.5K", price: 700.00, unit: "unit", category: "WHATSAPP_PROTOCOL", rating: 5.0, image: "bg-gray-900 text-green-500 border border-green-500/30", icon: <Users className="w-8 h-8" /> },
  { id: 15, name: "WA_FOLLOWERS_2K", price: 900.00, unit: "unit", category: "WHATSAPP_PROTOCOL", rating: 5.0, image: "bg-gray-900 text-green-500 border border-green-500/30", icon: <Users className="w-8 h-8" /> },
  { id: 16, name: "POST_REACT_1K_PACK", price: 5.00, unit: "unit", category: "REACT_INJECTION", rating: 4.9, image: "bg-gray-900 text-cyan-500 border border-cyan-500/30", icon: <ThumbsUp className="w-8 h-8" /> },
  { id: 17, name: "REACT_BOT_1_WEEK", price: 250.00, unit: "duration", category: "REACT_INJECTION", rating: 4.8, image: "bg-gray-900 text-purple-500 border border-purple-500/30", icon: <Activity className="w-8 h-8" /> },
  { id: 18, name: "REACT_BOT_2_WEEKS", price: 400.00, unit: "duration", category: "REACT_INJECTION", rating: 4.9, image: "bg-gray-900 text-purple-500 border border-purple-500/30", icon: <Activity className="w-8 h-8" /> },
  { id: 19, name: "REACT_BOT_3_WEEKS", price: 600.00, unit: "duration", category: "REACT_INJECTION", rating: 5.0, image: "bg-gray-900 text-purple-500 border border-purple-500/30", icon: <Activity className="w-8 h-8" /> },
  { id: 20, name: "REACT_BOT_1_MONTH", price: 800.00, unit: "duration", category: "REACT_INJECTION", rating: 5.0, image: "bg-gray-900 text-purple-500 border border-purple-500/30", icon: <Activity className="w-8 h-8" /> },
];

// --- Components ---

const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false, fullWidth = false }) => {
  const baseStyle = "px-4 py-2 font-mono text-sm uppercase tracking-wider transition-all duration-200 flex items-center justify-center gap-2 border shadow-[0_0_10px_rgba(0,0,0,0.5)]";
  const variants = {
    primary: "bg-green-600 border-green-500 text-black hover:bg-green-500 hover:shadow-[0_0_15px_rgba(34,197,94,0.4)] active:translate-y-0.5 font-bold",
    secondary: "bg-black text-green-500 border-green-500 hover:bg-green-900/20 hover:shadow-[0_0_15px_rgba(34,197,94,0.2)]",
    danger: "bg-red-900/20 text-red-500 border-red-500 hover:bg-red-900/40",
    ghost: "text-gray-500 hover:text-green-500 hover:bg-green-900/10 border-transparent",
    outline: "border border-green-500 text-green-500 hover:bg-green-500 hover:text-black"
  };
  
  return (
    <button 
      onClick={onClick} 
      disabled={disabled}
      className={`${baseStyle} ${variants[variant]} ${fullWidth ? 'w-full' : ''} ${disabled ? 'opacity-50 cursor-not-allowed grayscale' : ''} ${className}`}
    >
      {children}
    </button>
  );
};

const GlitchText = ({ text }) => (
  <span className="relative inline-block group">
    <span className="relative z-10">{text}</span>
    <span className="absolute top-0 left-0 -ml-0.5 translate-x-[2px] text-red-500 opacity-0 group-hover:opacity-70 animate-pulse">{text}</span>
    <span className="absolute top-0 left-0 -ml-0.5 -translate-x-[2px] text-blue-500 opacity-0 group-hover:opacity-70 animate-pulse delay-75">{text}</span>
  </span>
);

const Badge = ({ children }) => (
  <span className="absolute -top-2 -right-2 bg-red-600 text-black text-[10px] font-bold px-1.5 py-0.5 border border-red-500 shadow-[0_0_8px_rgba(220,38,38,0.5)]">
    {children}
  </span>
);

const ProductCard = ({ product, onAdd }) => (
  <div className="bg-black border border-green-800/50 p-1 hover:border-green-500 hover:shadow-[0_0_20px_rgba(34,197,94,0.15)] transition-all duration-300 flex flex-col group relative overflow-hidden">
    {/* Scanline effect overlay */}
    <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 pointer-events-none"></div>
    <div className="absolute top-0 right-0 p-2 opacity-50 group-hover:opacity-100 transition-opacity">
      <Code size={14} className="text-green-500" />
    </div>

    <div className={`h-40 w-full flex items-center justify-center ${product.image} relative mb-2`}>
      <div className="transform group-hover:scale-110 transition-transform duration-300 drop-shadow-[0_0_10px_rgba(34,197,94,0.5)]">
        {product.icon}
      </div>
    </div>
    <div className="p-3 flex flex-col flex-grow relative z-10">
      <div className="flex justify-between items-start mb-2">
        <span className="text-[10px] font-mono text-green-400 border border-green-900 px-1 py-0.5 uppercase tracking-widest">{product.category}</span>
        <div className="flex items-center text-green-700 text-xs">
          <Star size={10} fill="currentColor" />
          <span className="ml-1 font-mono">{product.rating}</span>
        </div>
      </div>
      <h3 className="font-mono font-bold text-gray-200 text-md mb-1 leading-tight tracking-tight">{product.name}</h3>
      <p className="text-gray-500 text-xs font-mono mb-4">Unit: {product.unit}</p>
      
      <div className="mt-auto flex items-center justify-between border-t border-gray-800 pt-3">
        <span className="text-lg font-mono font-bold text-green-500">Rs.{product.price}</span>
        <Button onClick={() => onAdd(product)} variant="outline" className="!px-3 !py-1 !text-xs">
          <Plus size={14} /> INJECT
        </Button>
      </div>
    </div>
  </div>
);

const CartItem = ({ item, onUpdateQuantity, onRemove }) => (
  <div className="flex items-center gap-4 py-4 border-b border-gray-800 last:border-0 font-mono">
    <div className={`w-16 h-16 border border-gray-700 flex items-center justify-center flex-shrink-0 bg-black`}>
      {React.cloneElement(item.icon, { className: "text-green-600 w-8 h-8" })}
    </div>
    <div className="flex-grow">
      <h4 className="font-bold text-gray-300 text-sm tracking-wide">{item.name}</h4>
      <p className="text-xs text-gray-500">Rs. {item.price.toFixed(2)} / {item.unit}</p>
    </div>
    <div className="flex items-center gap-3">
      <div className="flex items-center border border-gray-700 bg-gray-900/50">
        <button 
          onClick={() => onUpdateQuantity(item.id, -1)}
          className="w-8 h-8 flex items-center justify-center hover:bg-gray-800 text-green-500 transition-all disabled:opacity-30 disabled:hover:bg-transparent"
          disabled={item.quantity <= 1}
        >
          <Minus size={14} />
        </button>
        <span className="w-8 text-center text-green-500 text-sm">{item.quantity}</span>
        <button 
          onClick={() => onUpdateQuantity(item.id, 1)}
          className="w-8 h-8 flex items-center justify-center hover:bg-gray-800 text-green-500 transition-all"
        >
          <Plus size={14} />
        </button>
      </div>
      <button 
        onClick={() => onRemove(item.id)}
        className="text-gray-600 hover:text-red-500 p-2 transition-colors"
      >
        <Trash2 size={16} />
      </button>
    </div>
  </div>
);

// --- Main Application ---

export default function App() {
  const [view, setView] = useState('home'); // home, cart, checkout, success
  const [cart, setCart] = useState([]);
  const [activeCategory, setActiveCategory] = useState("ALL_NODES");
  const [searchQuery, setSearchQuery] = useState("");
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [toast, setToast] = useState(null);
  
  // Checkout Form State
  const [checkoutForm, setCheckoutForm] = useState({
    email: '',
    phone: '',
    name: '',
    address: '',
    city: '',
    zip: ''
  });

  // Derived state
  const cartItemCount = cart.reduce((acc, item) => acc + item.quantity, 0);
  const cartTotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
  
  // Filter products
  const filteredProducts = PRODUCTS.filter(product => {
    const matchesCategory = activeCategory === "ALL_NODES" || product.category === activeCategory;
    const matchesSearch = product.name.toLowerCase().includes(searchQuery.toLowerCase());
    return matchesCategory && matchesSearch;
  });

  // Handlers
  const addToCart = (product) => {
    setCart(prev => {
      const existing = prev.find(item => item.id === product.id);
      if (existing) {
        return prev.map(item => 
          item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
        );
      }
      return [...prev, { ...product, quantity: 1 }];
    });
    showToast(`> SYSTEM: INJECTED ${product.name}`);
  };

  const updateQuantity = (id, change) => {
    setCart(prev => prev.map(item => {
      if (item.id === id) {
        return { ...item, quantity: Math.max(1, item.quantity + change) };
      }
      return item;
    }));
  };

  const removeFromCart = (id) => {
    setCart(prev => prev.filter(item => item.id !== id));
  };

  const clearCart = () => {
    setCart([]);
    setView('success');
  };

  const showToast = (message) => {
    setToast(message);
    setTimeout(() => setToast(null), 3000);
  };

  const handlePlaceOrder = () => {
    const itemsList = cart.map(item => 
      `- ${item.name} (${item.quantity} x Rs.${item.price.toFixed(2)})`
    ).join('%0A');
    
    const totalAmount = (cartTotal * 1.08).toFixed(2);
    
    // Cyber-themed Receipt
    const message = `*// SUBNET MAFIA OPERATION RECEIPT* üîí%0A` +
      `*// STATUS: CLASSIFIED*%0A%0A` +
      `*TARGET_ID:* ${checkoutForm.name || 'ANONYMOUS'}%0A` +
      `*COMM_LINK:* ${checkoutForm.phone || 'ENCRYPTED'}%0A` +
      `*DROP_POINT:* ${checkoutForm.address || 'UNKNOWN SECTOR'}, ${checkoutForm.city || ''}%0A%0A` +
      `*PAYLOAD_MANIFEST:*%0A${itemsList}%0A%0A` +
      `*TOTAL_CREDITS:* Rs. ${totalAmount} (COD_PROTOCOL)`;

    window.open(`https://wa.me/94716344483?text=${message}`, '_blank');
    
    clearCart();
  };

  // --- View Components ---

  const HomeView = () => (
    <div className="space-y-8 animate-fade-in relative z-10">
      {/* Hero Section */}
      <div className="border border-green-500/30 bg-black/80 p-8 md:p-12 relative overflow-hidden group">
        <div className="absolute inset-0 bg-[linear-gradient(rgba(0,255,0,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,0,0.03)_1px,transparent_1px)] bg-[size:20px_20px]"></div>
        
        <div className="relative z-10 max-w-2xl">
          <div className="flex items-center gap-2 text-green-500 mb-2 font-mono text-xs">
            <span className="animate-pulse">‚óè</span> SYSTEM_ONLINE
          </div>
          <h1 className="text-4xl md:text-6xl font-mono font-bold mb-4 text-white tracking-tighter">
            SUBNET <span className="text-green-500">MAFIA</span><br/>
            CYBER GROUP
          </h1>
          <p className="text-gray-400 font-mono text-md mb-8 max-w-md border-l-2 border-green-500 pl-4">
            &gt; Social infrastructure manipulation.<br/>
            &gt; Digital asset acquisition.<br/>
            &gt; Anonymous transaction protocols.
          </p>
          <Button onClick={() => {
            document.getElementById('shop-section').scrollIntoView({ behavior: 'smooth' });
          }} variant="primary" className="!text-lg !px-8 !py-3">
             INITIALIZE SHOP
          </Button>
        </div>
        
        {/* Abstract Cyber Elements */}
        <div className="absolute right-10 top-10 text-green-900/20 pointer-events-none">
          <Shield size={200} strokeWidth={1} />
        </div>
      </div>

      {/* Categories & Search */}
      <div id="shop-section" className="flex flex-col md:flex-row gap-6 justify-between items-center sticky top-20 z-40 bg-black/90 backdrop-blur-md py-4 border-b border-green-900/50 -mx-4 px-4 md:mx-0 md:px-0 md:border-b-0">
        <div className="flex gap-2 overflow-x-auto pb-2 w-full md:w-auto scrollbar-hide">
          {CATEGORIES.map(cat => (
            <button
              key={cat}
              onClick={() => setActiveCategory(cat)}
              className={`px-4 py-2 text-xs font-mono transition-all border ${
                activeCategory === cat 
                  ? 'bg-green-600 text-black border-green-500 font-bold shadow-[0_0_10px_rgba(34,197,94,0.5)]' 
                  : 'bg-black text-green-600 border-green-900 hover:border-green-500 hover:text-green-400'
              }`}
            >
              [{cat}]
            </button>
          ))}
        </div>
        
        <div className="relative w-full md:w-80 group">
          <input
            type="text"
            placeholder="SEARCH_DATABASE..."
            className="w-full pl-10 pr-4 py-2 bg-black border border-green-900 text-green-500 font-mono placeholder-green-900 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.3)] transition-all"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
          <Search className="absolute left-3 top-2.5 text-green-700 group-focus-within:text-green-500" size={16} />
        </div>
      </div>

      {/* Product Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {filteredProducts.length > 0 ? (
          filteredProducts.map(product => (
            <ProductCard key={product.id} product={product} onAdd={addToCart} />
          ))
        ) : (
          <div className="col-span-full py-20 text-center flex flex-col items-center border border-dashed border-gray-800 rounded-lg">
            <Activity size={48} className="mb-4 text-red-900 animate-pulse" />
            <p className="text-lg font-mono text-red-500">ERROR: NO_DATA_FOUND</p>
            <p className="text-sm font-mono text-gray-600">Adjust search parameters.</p>
            <Button 
              variant="outline" 
              className="mt-4"
              onClick={() => { setActiveCategory("ALL_NODES"); setSearchQuery(""); }}
            >
              RESET_FILTERS
            </Button>
          </div>
        )}
      </div>
    </div>
  );

  const CartView = () => (
    <div className="max-w-4xl mx-auto animate-fade-in relative z-10">
      <div className="mb-6 flex items-center gap-2 text-xs font-mono text-gray-500">
        <button onClick={() => setView('home')} className="hover:text-green-500 hover:underline">ROOT</button>
        <span>/</span>
        <span className="text-green-500">CART_MANIFEST</span>
      </div>

      <h2 className="text-3xl font-mono font-bold text-white mb-8 border-b border-green-900 pb-4">
        <span className="text-green-500">&gt;&gt;</span> ACTIVE_PAYLOAD
      </h2>

      {cart.length === 0 ? (
        <div className="text-center py-20 bg-black border border-green-900/50">
          <div className="bg-gray-900 w-20 h-20 flex items-center justify-center mx-auto mb-6 rounded-none border border-green-900">
            <ShoppingBag size={32} className="text-green-600" />
          </div>
          <h3 className="text-xl font-mono font-bold text-gray-300 mb-2">BUFFER_EMPTY</h3>
          <p className="text-gray-600 font-mono mb-8 max-w-sm mx-auto">No operational assets selected.</p>
          <Button onClick={() => setView('home')} className="mx-auto" variant="outline">
            RETURN_TO_BASE
          </Button>
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Cart Items */}
          <div className="lg:col-span-2 bg-black border border-green-900 p-6">
            <div className="flex justify-between items-center mb-6 pb-4 border-b border-green-900/50">
              <span className="font-mono text-green-600">{cartItemCount} MODULES INSTALLED</span>
              <button onClick={() => setCart([])} className="text-red-500 text-xs font-mono hover:text-red-400 hover:underline">PURGE_ALL</button>
            </div>
            <div className="flex flex-col gap-2">
              {cart.map(item => (
                <CartItem 
                  key={item.id} 
                  item={item} 
                  onUpdateQuantity={updateQuantity} 
                  onRemove={removeFromCart} 
                />
              ))}
            </div>
          </div>

          {/* Order Summary */}
          <div className="lg:col-span-1">
            <div className="bg-black border border-green-500/50 p-6 sticky top-24 shadow-[0_0_20px_rgba(34,197,94,0.05)]">
              <h3 className="text-lg font-mono font-bold text-green-500 mb-6">COMPUTE_COSTS</h3>
              
              <div className="space-y-3 mb-6 font-mono text-sm">
                <div className="flex justify-between text-gray-400">
                  <span>BASE_COST</span>
                  <span>Rs. {cartTotal.toFixed(2)}</span>
                </div>
                <div className="flex justify-between text-gray-400">
                  <span>TRANSMISSION_FEE</span>
                  <span className="text-green-500">0.00</span>
                </div>
                <div className="flex justify-between text-gray-400">
                  <span>PROCESSING_TAX</span>
                  <span>Rs. {(cartTotal * 0.08).toFixed(2)}</span>
                </div>
                <div className="border-t border-green-900 pt-3 mt-3">
                  <div className="flex justify-between items-center text-white">
                    <span className="font-bold">TOTAL_CREDITS</span>
                    <span className="font-bold text-green-500 text-lg">Rs. {(cartTotal * 1.08).toFixed(2)}</span>
                  </div>
                </div>
              </div>

              <Button 
                fullWidth 
                onClick={() => setView('checkout')}
                className="py-4 text-lg"
                variant="primary"
              >
                INIT_CHECKOUT
              </Button>
              
              <p className="text-[10px] text-green-800 text-center mt-4 font-mono">
                ENCRYPTED CONNECTION ESTABLISHED
              </p>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  const CheckoutView = () => (
    <div className="max-w-2xl mx-auto animate-fade-in relative z-10">
       <div className="mb-6 flex items-center gap-2 text-xs font-mono text-gray-500">
        <button onClick={() => setView('cart')} className="hover:text-green-500 hover:underline">CART</button>
        <span>/</span>
        <span className="text-green-500">EXECUTE</span>
      </div>

      <div className="bg-black border border-green-900 shadow-[0_0_30px_rgba(0,0,0,0.5)]">
        <div className="bg-green-900/10 p-6 border-b border-green-900">
          <h2 className="text-2xl font-mono font-bold text-green-500">FINAL_EXECUTION</h2>
          <p className="text-gray-500 text-xs font-mono mt-1">Provide drop details for physical/digital handoff.</p>
        </div>

        <div className="p-8 space-y-8 font-mono">
          {/* Section 1: Contact */}
          <section>
            <h3 className="text-md font-bold text-gray-300 mb-4 flex items-center gap-2">
              <span className="text-green-500">[1]</span>
              COMMS_INFO
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input 
                type="email" 
                placeholder="EMAIL_ID" 
                value={checkoutForm.email}
                onChange={(e) => setCheckoutForm({...checkoutForm, email: e.target.value})}
                className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
              />
              <input 
                type="tel" 
                placeholder="PHONE_UPLINK" 
                value={checkoutForm.phone}
                onChange={(e) => setCheckoutForm({...checkoutForm, phone: e.target.value})}
                className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
              />
            </div>
          </section>

          {/* Section 2: Address */}
          <section>
            <h3 className="text-md font-bold text-gray-300 mb-4 flex items-center gap-2">
              <span className="text-green-500">[2]</span>
              LOCATION_DATA
            </h3>
            <div className="space-y-4">
              <input 
                type="text" 
                placeholder="OPERATIVE_NAME" 
                value={checkoutForm.name}
                onChange={(e) => setCheckoutForm({...checkoutForm, name: e.target.value})}
                className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
              />
              <input 
                type="text" 
                placeholder="SECTOR_ADDRESS" 
                value={checkoutForm.address}
                onChange={(e) => setCheckoutForm({...checkoutForm, address: e.target.value})}
                className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
              />
              <div className="grid grid-cols-2 gap-4">
                <input 
                  type="text" 
                  placeholder="CITY_NODE" 
                  value={checkoutForm.city}
                  onChange={(e) => setCheckoutForm({...checkoutForm, city: e.target.value})}
                  className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
                />
                <input 
                  type="text" 
                  placeholder="ZONE_CODE" 
                  value={checkoutForm.zip}
                  onChange={(e) => setCheckoutForm({...checkoutForm, zip: e.target.value})}
                  className="w-full px-4 py-3 bg-black border border-gray-700 text-green-500 focus:outline-none focus:border-green-500 focus:shadow-[0_0_10px_rgba(34,197,94,0.2)]" 
                />
              </div>
            </div>
          </section>

          {/* Section 3: Payment */}
          <section>
            <h3 className="text-md font-bold text-gray-300 mb-4 flex items-center gap-2">
              <span className="text-green-500">[3]</span>
              TRANSFER_PROTOCOL
            </h3>
            
            <div className="bg-green-900/10 p-6 border border-green-900 mb-4 text-center">
              <div className="bg-black w-12 h-12 flex items-center justify-center mx-auto mb-3 border border-green-500 text-green-500 shadow-[0_0_15px_rgba(34,197,94,0.4)]">
                <Banknote size={24} />
              </div>
              <h4 className="font-bold text-green-500 mb-1">CASH_ON_DELIVERY</h4>
              <p className="text-gray-500 text-xs">Physical asset exchange required upon completion.</p>
            </div>
          </section>

          <Button onClick={handlePlaceOrder} fullWidth size="lg" className="py-4 text-lg" variant="primary">
             TRANSMIT_ORDER &gt;
          </Button>
        </div>
      </div>
    </div>
  );

  const SuccessView = () => (
    <div className="min-h-[60vh] flex flex-col items-center justify-center text-center animate-fade-in p-4 relative z-10">
      <div className="w-24 h-24 bg-black border-2 border-green-500 flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(34,197,94,0.3)]">
        <CheckCircle size={48} className="text-green-500" />
      </div>
      <h1 className="text-4xl font-mono font-bold text-white mb-4">TRANSMISSION COMPLETE</h1>
      <p className="text-gray-400 font-mono text-sm max-w-md mb-8">
        Operation details have been logged. Stand by for contact from handler.<br/>
        <span className="text-green-800 text-xs mt-2 block">LOG_ID: {Math.random().toString(36).substr(2, 9).toUpperCase()}</span>
      </p>
      <div className="flex gap-4">
        <Button onClick={() => setView('home')} className="px-8" variant="outline">
          TERMINATE_SESSION
        </Button>
      </div>
    </div>
  );

  // --- Layout Structure ---

  return (
    <div className="font-sans min-h-screen bg-black text-gray-300 selection:bg-green-500 selection:text-black">
      {/* Background Matrix/Grid Effect */}
      <div className="fixed inset-0 pointer-events-none z-0">
         <div className="absolute inset-0 bg-[linear-gradient(rgba(0,100,0,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(0,100,0,0.1)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20"></div>
         <div className="absolute inset-0 bg-black opacity-90"></div>
      </div>

      {/* Toast Notification */}
      {toast && (
        <div className="fixed bottom-6 right-6 bg-black border border-green-500 text-green-500 px-6 py-4 shadow-[0_0_20px_rgba(34,197,94,0.3)] z-50 flex items-center gap-4 animate-fade-in-up font-mono text-sm max-w-sm">
          <Terminal size={18} className="animate-pulse" />
          <span className="font-bold">{toast}</span>
        </div>
      )}

      {/* Header */}
      <header className="sticky top-0 z-50 bg-black/95 border-b border-green-900 backdrop-blur-sm">
        <div className="container mx-auto px-4 lg:px-8 h-20 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <button 
              className="lg:hidden p-2 text-green-500 border border-green-900 hover:bg-green-900/20"
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
            >
              {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
            </button>
            
            <div 
              className="flex items-center gap-3 cursor-pointer group" 
              onClick={() => setView('home')}
            >
              <div className="text-green-500 border border-green-500 p-1 group-hover:shadow-[0_0_15px_rgba(34,197,94,0.6)] transition-all bg-black">
                <Terminal size={24} />
              </div>
              <div className="flex flex-col">
                <span className="text-lg font-mono font-bold tracking-widest text-white leading-none group-hover:text-green-400 transition-colors">
                  SUBNET<span className="text-green-600">_MAFIA</span>
                </span>
                <span className="text-[10px] font-mono text-green-800 leading-none tracking-[0.2em]">CYBER_GROUP</span>
              </div>
            </div>
          </div>

          <nav className="hidden lg:flex items-center gap-8 font-mono text-sm text-gray-500">
            <button onClick={() => setView('home')} className={`hover:text-green-500 transition-colors ${view === 'home' ? 'text-green-500 border-b border-green-500' : ''}`}>[MARKET]</button>
            <button className="hover:text-green-500 transition-colors">[EXPLOITS]</button>
            <button className="hover:text-green-500 transition-colors">[FORUM]</button>
            <button className="hover:text-green-500 transition-colors">[ENCRYPT]</button>
          </nav>

          <div className="flex items-center gap-2 md:gap-4">
            <div className="hidden md:flex items-center gap-2 text-[10px] font-mono text-green-700 border border-green-900 px-3 py-1.5 bg-black">
              <Wifi size={12} className="text-green-500 animate-pulse" />
              <span>IP: 192.168.0.X</span>
            </div>
            
            <button 
              className="relative p-2.5 border border-transparent hover:border-green-500 transition-all group bg-black"
              onClick={() => setView('cart')}
            >
              <ShoppingCart size={24} className="text-gray-400 group-hover:text-green-500" />
              {cartItemCount > 0 && (
                <span className="absolute -top-1 -right-1 bg-green-600 text-black text-[10px] font-bold px-1.5 py-0.5 border border-green-400 font-mono">
                  {cartItemCount}
                </span>
              )}
            </button>
          </div>
        </div>
        
        {/* Mobile Menu */}
        {isMobileMenuOpen && (
          <div className="lg:hidden absolute top-20 left-0 w-full bg-black border-b border-green-900 p-4 shadow-lg animate-fade-in-down">
            <nav className="flex flex-col gap-2 font-mono">
              <button onClick={() => { setView('home'); setIsMobileMenuOpen(false); }} className="text-left py-3 px-4 text-green-500 border border-green-900 hover:bg-green-900/20">&gt; ACCESS_MARKET</button>
              <button className="text-left py-3 px-4 text-gray-400 border border-gray-900 hover:text-green-500 hover:border-green-900">&gt; VIEW_EXPLOITS</button>
              <button className="text-left py-3 px-4 text-gray-400 border border-gray-900 hover:text-green-500 hover:border-green-900">&gt; USER_LOGS</button>
            </nav>
          </div>
        )}
      </header>

      {/* Main Content */}
      <main className="container mx-auto px-4 lg:px-8 py-8 min-h-[calc(100vh-5rem)] relative z-10">
        {view === 'home' && <HomeView />}
        {view === 'cart' && <CartView />}
        {view === 'checkout' && <CheckoutView />}
        {view === 'success' && <SuccessView />}
      </main>

      {/* Footer */}
      <footer className="bg-black border-t border-green-900 mt-auto py-12 relative z-10">
        <div className="container mx-auto px-4 text-center">
          <div className="flex items-center justify-center gap-2 mb-4 text-green-900">
            <Terminal size={24} />
            <span className="text-xl font-mono font-bold tracking-widest">SUBNET_MAFIA</span>
          </div>
          <p className="text-gray-600 text-xs font-mono mb-6">
            // UNAUTHORIZED ACCESS IS PROHIBITED.<br/>
            // ALL CONNECTIONS ARE MONITORED.
          </p>
          <div className="flex justify-center gap-6 mt-6 text-xs font-mono text-gray-600">
            <a href="#" className="hover:text-green-500 transition-colors hover:underline">PROTOCOL_V2</a>
            <a href="#" className="hover:text-green-500 transition-colors hover:underline">TERMS_OF_ENGAGEMENT</a>
            <a href="#" className="hover:text-green-500 transition-colors hover:underline">CONTACT_ADMIN</a>
          </div>
        </div>
      </footer>
      
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
          font-family: 'JetBrains Mono', monospace;
        }

        @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in-down {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
        .animate-fade-in-down { animation: fade-in-down 0.3s ease-out forwards; }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Scrollbar for Chrome/Safari/Edge */
        ::-webkit-scrollbar {
          width: 8px;
        }
        ::-webkit-scrollbar-track {
          background: #000;
        }
        ::-webkit-scrollbar-thumb {
          background: #111;
          border: 1px solid #15803d;
        }
        ::-webkit-scrollbar-thumb:hover {
          background: #15803d;
        }
      `}</style>
    </div>
  );
}
